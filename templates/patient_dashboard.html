<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard - WellSure</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- Standard Global Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="WellSure"
                    style="height: 42px; width: 42px; object-fit: cover; margin-right: 12px; border-radius: 50%;">
                <span>WellSure</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="/view_doctors">Find Doctors</a></li>
                    <li class="nav-item"><a class="nav-link" href="/my_appointments">Appointments</a></li>
                    <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="/contact">Contact</a></li>
                </ul>
                <div class="d-flex align-items-center">
                    <button class="theme-btn me-3" id="themeToggle" title="Toggle Theme"><i
                            class="fa-solid fa-moon"></i></button>
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                            data-bs-toggle="dropdown">
                            {{ session.name }}
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end"
                            style="background: var(--bg-card); border-color: var(--border-color);">
                            <li><a class="dropdown-item text-primary" href="#" data-bs-toggle="modal"
                                    data-bs-target="#profileModal">Profile</a></li>
                            <li>
                                <hr class="dropdown-divider" style="border-color: var(--border-color);">
                            </li>
                            <li><a class="dropdown-item text-danger" href="/logout">Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-5 pt-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-1 text-main">Hello, {{ session.name }} ðŸ‘‹</h2>
                <p class="text-secondary">Welcome back to your health dashboard.</p>
            </div>
            <a href="/check_symptoms" class="btn btn-primary-gradient"><i class="fa-solid fa-stethoscope me-2"></i>Check
                Symptoms</a>
        </div>

        <!-- Quick Actions Grid -->
        <div class="row g-4 mb-5">
            <div class="col-md-4">
                <a href="/check_symptoms" class="text-decoration-none">
                    <div class="card-pro text-center p-4 h-100">
                        <div class="mb-3">
                            <i class="fa-solid fa-virus-covid fa-3x text-primary"></i>
                        </div>
                        <h5 class="text-main">AI Diagnosis</h5>
                        <p class="text-secondary small">Analyze symptoms and get instant predictions.</p>
                    </div>
                </a>
            </div>

            <div class="col-md-4">
                <a href="/view_doctors" class="text-decoration-none">
                    <div class="card-pro text-center p-4 h-100">
                        <div class="mb-3">
                            <i class="fa-solid fa-user-doctor fa-3x text-info"></i>
                        </div>
                        <h5 class="text-main">Find Specialists</h5>
                        <p class="text-secondary small">Book appointments with top doctors near you.</p>
                    </div>
                </a>
            </div>

            <div class="col-md-4">
                <a href="/my_appointments" class="text-decoration-none">
                    <div class="card-pro text-center p-4 h-100">
                        <div class="mb-3">
                            <i class="fa-solid fa-calendar-check fa-3x text-success"></i>
                        </div>
                        <h5 class="text-main">My Appointments</h5>
                        <p class="text-secondary small">Track your visits and download prescriptions.</p>
                    </div>
                </a>
            </div>
        </div>

        <!-- My Health History Section (READ-ONLY) -->
        <div class="card-pro mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0 text-main"><i class="fa-solid fa-clock-rotate-left text-primary me-2"></i>My Health
                    History</h5>
                <span class="badge bg-secondary bg-opacity-10 text-secondary small">Read-Only</span>
            </div>

            {% if health_history and health_history|length > 0 %}
            <div class="table-responsive">
                <table class="table table-sm table-hover mb-0">
                    <thead>
                        <tr class="table-light">
                            <th class="small text-muted">Date</th>
                            <th class="small text-muted">Symptoms</th>
                            <th class="small text-muted">Diagnosis</th>
                            <th class="small text-muted">Confidence</th>
                            <th class="small text-muted">Specialist</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in health_history %}
                        <tr>
                            <td class="small text-nowrap">{{ record.created_at.strftime('%d %b %Y') if record.created_at
                                else 'N/A' }}</td>
                            <td class="small text-truncate" style="max-width: 200px;"
                                title="{{ record.symptoms_text }}">{{ record.symptoms_text[:50] }}...</td>
                            <td class="small fw-medium text-primary">{{ record.disease_predicted }}</td>
                            <td>
                                {% if record.confidence_level == 'HIGH' %}
                                <span class="badge bg-success bg-opacity-10 text-success small">HIGH</span>
                                {% elif record.confidence_level == 'MEDIUM' %}
                                <span class="badge bg-warning bg-opacity-10 text-warning small">MEDIUM</span>
                                {% else %}
                                <span class="badge bg-danger bg-opacity-10 text-danger small">LOW</span>
                                {% endif %}
                            </td>
                            <td class="small">{{ record.specialist }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <i class="fa-regular fa-folder-open fa-2x text-muted mb-2"></i>
                <p class="text-muted small mb-0">No diagnosis history yet. Check your symptoms to get started!</p>
            </div>
            {% endif %}
        </div>

        <!-- Profile Section / Quick View -->
        <div class="card-pro mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0 text-main">My Health Profile</h5>
                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal"
                    data-bs-target="#profileModal"><i class="fa-solid fa-pen"></i> Edit</button>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-1 small text-secondary">Medical History</p>
                    <p class="fw-medium text-main">{{ user.medical_history if user and user.medical_history else 'No
                        history recorded' }}</p>
                </div>
                <div class="col-md-6">
                    <p class="mb-1 small text-secondary">Location</p>
                    <p class="fw-medium text-main">{{ user.city }} - {{ user.pincode }}</p>
                    <p class="small text-muted">{{ user.address }}</p>
                </div>
            </div>
        </div>

    </div>

    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form action="/update_patient_profile" method="post">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <input type="text" name="name" class="form-control"
                                value="{{ user.name if user and user.name else session.name }}" required>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-6">
                                <label class="form-label">Age</label>
                                <input type="number" name="age" class="form-control" min="1" max="120"
                                    value="{{ user.age if user and user.age else '' }}" placeholder="Your Age">
                            </div>
                            <div class="col-6">
                                <label class="form-label">Gender</label>
                                <select name="gender" class="form-select">
                                    <option value="">Select Gender</option>
                                    <option value="male" {{ 'selected' if user and user.gender and
                                        user.gender.lower()=='male' else '' }}>Male</option>
                                    <option value="female" {{ 'selected' if user and user.gender and
                                        user.gender.lower()=='female' else '' }}>Female</option>
                                    <option value="other" {{ 'selected' if user and user.gender and
                                        user.gender.lower()=='other' else '' }}>Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Medical History / Allergies</label>
                            <textarea name="medical_history" class="form-control" rows="3"
                                placeholder="Diabetes, Penicillin Allergy, etc.">{{ user.medical_history if user and user.medical_history else '' }}</textarea>
                        </div>
                        <hr class="border-secondary my-3">
                        <h6 class="mb-3 text-secondary">Location</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">City</label>
                                <input type="text" name="city" class="form-control"
                                    value="{{ user.city if user and user.city else '' }}" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Pincode</label>
                                <input type="text" name="pincode" class="form-control"
                                    value="{{ user.pincode if user and user.pincode else '' }}" required>
                            </div>
                            <div class="col-12">
                                <label class="form-label">Address</label>
                                <input type="text" name="address" class="form-control"
                                    value="{{ user.address if user and user.address else '' }}" required>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary-gradient">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation (App-like) -->
    <nav class="mobile-bottom-nav">
        <div class="nav-container">
            <a href="/" class="nav-item">
                <i class="fa-solid fa-house"></i>
                <span>Home</span>
            </a>
            <a href="/check_symptoms" class="nav-item">
                <i class="fa-solid fa-stethoscope"></i>
                <span>Symptoms</span>
            </a>
            <a href="/view_doctors" class="nav-item nav-main">
                <i class="fa-solid fa-user-doctor"></i>
                <span>Doctors</span>
            </a>
            <a href="/my_appointments" class="nav-item">
                <i class="fa-solid fa-calendar-check"></i>
                <span>Appts</span>
            </a>
            <a href="/patient_dashboard" class="nav-item active">
                <i class="fa-solid fa-user"></i>
                <span>Profile</span>
            </a>
        </div>
    </nav>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
</body>

</html>